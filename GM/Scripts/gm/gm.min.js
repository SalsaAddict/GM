var GM,gm;(function(n){"use strict";var t,i,r,u,f;n.googleApiKey="AIzaSyCtuJp3jsaJp3X6U8ZS_X5H8omiAw5QaHg";n.debugEnabled=!1;n.authenticated=!1,function(n){var t=function(){function t(n,t,i){this.$q=n;this.$http=t;this.$log=i}return t.prototype.execute=function(t,i){var f=this,u,r;return i===void 0&&(i={}),u={name:t,parameters:i},r=this.$q.defer(),i.UserId={value:n.userId},this.$log.debug("gm:execute",u),this.$http.post("execute.ashx",u).then(function(n){r.resolve(n.data);n.data.success||f.$log.warn(n.data.data)},function(n){r.resolve({success:!1,data:n.statusText});f.$log.warn(n.status,n.statusText)}),r.promise},t.prototype.FetchGenres=function(){return this.execute("apiGenres")},t.prototype.FetchStyles=function(n){return this.execute("apiStyles",{GenreId:{value:n}})},t.$inject=["$q","$http","$log"],t}();n.Service=t}(t=n.Database||(n.Database={})),function(t){function i(n){for(var i,r=["youtube.com/.*?v=([^?&/]+)","youtu.be/([^?&/]+)"],u,t=0;t<r.length;t++)if(i=new RegExp(r[t],"i"),i.test(n)){u=i.exec(n)[1];break}return u}function r(){var t=function(t,r){return{restrict:"A",scope:{video:"=videoIdValidator"},require:["ngModel"],link:function(u,f,e,o){o[0].$parsers.unshift(function(n){return o[0].$isEmpty(n)&&delete u.video,n});o[0].$asyncValidators.videoId=function(f,e){var h=i(f||e),o=r.defer(),c=function(n){u.video=n;o.resolve(!0)},s=function(){delete u.video;o.reject(!1)};return h?(t.get("https://www.googleapis.com/youtube/v3/videos?id="+h+"&key="+n.googleApiKey+"&part=snippet").then(function(n){try{var t=n.data.items[0];if(t.id!==h){s();return}c({id:t.id,title:t.snippet.title,thumbnail:t.snippet.thumbnails.medium.url})}catch(i){s()}},function(){s()}),o.promise):(s(),o.promise)}}}};return t.$inject=["$http","$q"],t}t.VideoIdFromUrl=i;t.DirectiveFactory=r}(i=n.VideoIdValidator||(n.VideoIdValidator={})),function(n){var t=function(){function n(n,t,i){var r=this;this.$scope=n;this.$database=t;this.$location=i;t.execute("apiUserSettings").then(function(n){r.Genre=n.data.Genre;r.Style=n.data.Style;r.FetchGenres();r.FetchStyles();r.FetchVideos()})}return n.prototype.FetchGenres=function(){var n=this;this.$database.FetchGenres().then(function(t){n.$scope.genres=t.data.Genres})},n.prototype.FetchStyles=function(){var n=this;if(!this.Genre){delete this.$scope.styles;return}this.$database.FetchStyles(this.Genre.Id).then(function(t){n.$scope.styles=t.data.Styles})},n.prototype.SetGenre=function(n){n?this.Genre=n:delete this.Genre;delete this.Style;this.FetchStyles();this.FetchVideos()},n.prototype.SetStyle=function(n){n?this.Style=n:delete this.Style;this.FetchVideos()},n.prototype.FetchVideos=function(){var t=this,n={};this.Genre&&(n.GenreId={value:this.Genre.Id},this.Style&&(n.StyleId={value:this.Style.Id}));this.$database.execute("apiVideos",n).then(function(n){t.$scope.videos=n.data.Videos})},n.$inject=["$scope","$database","$location"],n}();n.Controller=t}(r=n.Home||(n.Home={})),function(n){var t=function(){function n(n,t,i){var r=this;this.$scope=n;this.$database=t;this.$routeParams=i;t.execute("apiVideo",{VideoId:{value:i.videoId},GenreId:{value:i.genreId}}).then(function(t){n.video=t.data.Video;var i=new YT.Player("player",{videoId:n.video.VideoId,height:"390",width:"640",events:{onReady:function(n){n.target.playVideo()}}});r.FetchReviews()})}return n.prototype.FetchReviews=function(){var n=this;this.$database.execute("apiReviews",{VideoId:{value:this.$routeParams.videoId},GenreId:{value:this.$routeParams.genreId}}).then(function(t){n.$scope.reviews=t.data.Reviews})},n.prototype.Review=function(n,t){var i=this;this.$database.execute("apiReview",{VideoId:{value:this.$routeParams.videoId},GenreId:{value:this.$routeParams.genreId},styleId:{value:n},Like:{value:t}}).then(function(n){i.$scope.reviews=n.data.Reviews})},n.$inject=["$scope","$database","$routeParams"],n}();n.Controller=t}(u=n.Video||(n.Video={})),function(n){var t=function(){function n(n,t,i,r){this.$scope=n;this.$database=t;this.$http=i;this.$location=r;this.FetchGenres()}return n.prototype.FetchGenres=function(){var n=this;this.$database.FetchGenres().then(function(t){n.Genres=t.data.Genres})},n.prototype.FetchStyles=function(){var n=this;this.$database.FetchStyles(this.GenreId).then(function(t){n.Styles=t.data.Styles})},Object.defineProperty(n.prototype,"SelectedStyles",{get:function(){var t,n;if(angular.isArray(this.Styles)){for(n=0;n<this.Styles.length;n++)if(this.Styles[n].Checked){t=!0;break}return t}},enumerable:!0,configurable:!0}),n.prototype.Submit=function(){var n=this;this.$database.execute("apiRecommend",{VideoId:{value:this.$scope.video.id},Title:{value:this.$scope.video.title},Thumbnail:{value:this.$scope.video.thumbnail},Styles:{value:{data:this.Styles},isObject:!0}}).then(function(t){t.success&&n.$location.path("/video/"+n.$scope.video.id+"/"+n.GenreId)})},n.$inject=["$scope","$database","$http","$location"],n}();n.Controller=t}(f=n.Recommend||(n.Recommend={}))})(GM||(GM={}));gm=angular.module("gm",["ngRoute","ngAnimate","ngAria","ngMessages","ngSanitize","ngMaterial"]);gm.service("$database",GM.Database.Service);gm.directive("videoIdValidator",GM.VideoIdValidator.DirectiveFactory());gm.config(["$mdThemingProvider","$routeProvider","$logProvider",function(n,t,i){n.theme("default").primaryPalette("blue").accentPalette("indigo").warnPalette("red").backgroundPalette("grey");t.caseInsensitiveMatch=!0;t.when("/home",{templateUrl:"Views/home.html",controller:GM.Home.Controller,controllerAs:"ctrl"}).when("/video/:videoId/:genreId",{templateUrl:"Views/video.html",controller:GM.Video.Controller,controllerAs:"ctrl"}).when("/recommend",{templateUrl:"Views/recommend.html",controller:GM.Recommend.Controller,controllerAs:"ctrl"}).otherwise({redirectTo:"/home"});i.debugEnabled(GM.debugEnabled)}]);gm.run(["$log",function(){GM.authenticated=document.getElementById("gm-script").getAttribute("data-authenticated").toLowerCase()==="true";GM.authenticated&&(GM.Database.userId=document.getElementById("gm-script").getAttribute("data-id"))}]);